@page
@model ExersiceModel
@{
    ViewData["Title"] = "ExercisesEdit";
}

@section Scripts {
    <script>
        // Assuming you are passing PupilId from Razor to JS
        const pupilId = @Model.PupilId;

        // Function to fetch exercises from API
        async function fetchExercises() {
            try {
                const response = await fetch(`http://localhost:5000/api/pupils/${pupilId}/exercises`, {
                    method: 'GET',
                    headers: {
                        'Accept': 'application/json',
                    },
                });

                if (response.ok) {
                    const exercises = await response.json();
                    const tableBody = document.querySelector('table tbody'); // Reference to the tbody element

                    // Clear any existing rows (if any)
                    tableBody.innerHTML = '';

                    // Iterate through each exercise and create a table row
                    exercises.forEach((exercise, index) => {
                        const newRow = document.createElement('tr');
                        newRow.innerHTML = `
                                    <td>${index + 1}</td>
                                    <td><input type="text" value="${exercise.label}" disabled></td>
                                    <td><input type="text" value="${exercise.weight}" disabled></td>
                                    <td><input type="text" value="${exercise.reps}" disabled></td>
                                    <td><input type="text" value="${exercise.comment}" disabled></td>
                                    <td><button class="delete-row">Usuń</button></td>
                                `;
                        tableBody.appendChild(newRow);
                    });
                } else {
                    console.error('Błąd odpowiedzi API:', response.statusText);
                }
            } catch (error) {
                console.error("Błąd podczas zapytania:", error);
            }
        }

        // Fetch exercises when the page loads
        document.addEventListener('DOMContentLoaded', function () {
            fetchExercises(); // Fetch exercises using pupilId
        });

        // Function to handle delete row action
        document.addEventListener('click', function (event) {
            if (event.target.classList.contains('delete-row')) {
                event.target.closest('tr').remove(); // Remove the clicked row
            }
        });

        // Optionally, handle the "Add Exercise" button if needed:
        document.querySelector('.add-row').addEventListener('click', function () {
            const tableBody = document.querySelector('table tbody');
            const newRow = document.createElement('tr');
            newRow.innerHTML = `
                        <td>${tableBody.rows.length + 1}</td>
                        <td><input type="text" placeholder="Ćwiczenie"></td>
                        <td><input type="text" placeholder="Obciążenie"></td>
                        <td><input type="text" placeholder="Powtórzenia"></td>
                        <td><input type="text" placeholder="Uwagi"></td>
                        <td><button class="delete-row">Usuń</button></td>
                    `;
            tableBody.appendChild(newRow);
        });
    </script>
}

<div class="container">
    <header>
        <h1>Plany Treningowe</h1>
    </header>
    <section class="training-info">
        <div class="info-box">
            <h3>Tytuł: Redukcja tkanki tłuszczowej</h3>
            <p>Podopieczny: Adam Nowak</p>
            <p>Termin: 2023-05-16</p>
        </div>
    </section>
    <section class="training-table">
        <table>
            <thead>
                <tr>
                    <th>Część</th>
                    <th>Ćwiczenie</th>
                    <th>Obciążenie</th>
                    <th>Powtórzenia</th>
                    <th>Uwagi</th>
                    <th>Akcje</th>
                </tr>
            </thead>
            <tbody>
                <!-- Dynamic rows will be inserted here -->
            </tbody>
        </table>
        <button class="add-row">Dodaj ćwiczenie</button>
        <button class="save-changes">Zapisz zmiany</button>
    </section>
</div>
