@page "{id:int}"
@model ExersiceModel
@{
    ViewData["Title"] = "ExercisesEdit";
}

@section Scripts {
    <script>
        // Fetch exercises for the given pupil ID
        async function fetchExercises(pupilId) {
            try {
                const response = await fetch(`http://localhost:5000/api/pupils/${pupilId}/exercises`, {
                    method: 'GET',
                    headers: {
                        'Accept': 'application/json',
                    },
                });

                if (response.ok) {
                    const exercises = await response.json();
                    const tableBody = document.querySelector('table tbody');

                    // Clear existing rows
                    tableBody.innerHTML = '';

                    // Add rows dynamically based on fetched data
                    exercises.forEach((exercise, index) => {
                        const newRow = document.createElement('tr');
                        newRow.innerHTML = `
                                    <td>${index + 1}</td>
                                    <td><input type="text" value="${exercise.label}" disabled></td>
                                    <td><input type="text" value="${exercise.weight}" disabled></td>
                                    <td><input type="text" value="${exercise.reps}" disabled></td>
                                    <td><input type="text" value="${exercise.comment}" disabled></td>
                                    <td><button class="delete-row">Usuń</button></td>
                                `;
                        tableBody.appendChild(newRow);
                    });
                } else {
                    console.error('Błąd odpowiedzi API:', response.statusText);
                }
            } catch (error) {
                console.error("Błąd podczas zapytania:", error);
            }
        }

        // Get the pupil ID from the Razor model and fetch exercises
        document.addEventListener('DOMContentLoaded', function () {
            const pupilId = @Model.PupilId; // Injected from the Razor model
            fetchExercises(pupilId); // Fetch exercises based on pupil ID
        });

        // Delete row functionality
        document.addEventListener('click', function (event) {
            if (event.target.classList.contains('delete-row')) {
                event.target.closest('tr').remove();
            }
        });
    </script>
}

<div class="container">
    <header>
        <h1>Plany Treningowe</h1> 
    </header>
    <section class="training-table">
        <table>
            <thead>
                <tr>
                    <th>lp.</th>
                    <th>Ćwiczenie</th>
                    <th>Obciążenie</th>
                    <th>Powtórzenia</th>
                    <th>Uwagi</th>
                    <th>Akcje</th>
                </tr>
            </thead>
            <tbody>
                <!-- Dynamic rows will be inserted here -->
            </tbody>
        </table>
        <button class="add-row">Dodaj ćwiczenie</button>
        <button class="save-changes">Zapisz zmiany</button>
    </section>
</div>
